<script>

  function insertarContacto()
  {      
    let nombre = document.getElementById('nombre').value;
    let correo = document.getElementById('correo').value;
    let apellido = document.getElementById('apellidos').value;
    let telefono = document.getElementById('tel').value;

    bootstrap.Modal.getInstance(document.getElementById('crearContactoModal')).hide();
    eliminarTabla();
    crearLoaderAnillos('divContactos');
      google.script.run
          .withSuccessHandler(insertarContactoCorrecto)
          .withFailureHandler(insertarContactoError)
          .insertarContacto(nombre,apellido,correo,telefono);
  }

  function insertarContactoCorrecto(){
    document.getElementById('nombre').value ='';
    document.getElementById('correo').value ='';
    crearNotificacionOk('Datos cargados correctamente','Exelente');
    eliminarLoader();
    crearTablaContactos();
  }

  function insertarContactoError(){
    crearNotificacionError('Ha habido un error en el ingreso de datos','Error');
    eliminarLoader();
    crearTablaContactos();
  }

  function crearTablaContactos()
  {      
    crearLoaderAnillos('divContactos');
      google.script.run
          .withSuccessHandler(crearTablaContactosCorrecta)
          .withFailureHandler(crearTablaContactosError)
          .obtenerContactos();
  }

  function crearTablaContactosCorrecta(obj) {
        eliminarTabla();
        tabla = document.createElement('table');
        tabla.id = 'tablaContactos';

        let tablaHeader = document.createElement('thead');
        let tablaBody = document.createElement('tbody');

        for (let i = 0;i < obj.length;i++) {
            let fila = document.createElement('tr');
            for (let j = 0;j < obj[i].length;j++) {
                console.log(obj[i][j]);
                let celda = document.createElement('td');
                celda.textContent = obj[i][j];
                fila.appendChild(celda);

                if(i==0)
                {
                    tablaHeader.appendChild(fila);
                    tabla.appendChild(tablaHeader);
                }
                else
                {
                    tablaBody.appendChild(fila);
                }
            }
            
        }
        tablaHeader.classList.add('table-dark');
        tabla.appendChild(tablaBody);
        tabla.classList.add('table','table-striped','border','border-4','border-dark');
        document.getElementById('divContactos').appendChild(tabla);
        
        crearNotificacionOk('Contacto obtenidos correctamente','Todo en orden');
        eliminarLoader();
  }

  function crearTablaContactosError() {
    crearNotificacionError('No se han podido leer los contactos','ERROR');
    eliminarLoader();
  }

  function crearNotificacion(mensaje,titulo) {
    document.getElementById('mensajeNotificacion').textContent = mensaje;
    document.getElementById('tituloNotificacion').textContent = titulo;
    let elemetoNotificacion = document.getElementById('notificacion');
    bootstrap.Toast.getOrCreateInstance(elemetoNotificacion).show();
  }

    function crearNotificacionOk(mensaje,titulo) {
        crearNotificacion(mensaje,titulo);
        notificacionIconoOk();
        crearColorNotificacion('--color-verde-oscuro')
    }
    function crearNotificacionError(mensaje,titulo) {
        crearNotificacion(mensaje,titulo);
        notificacionIconoError();
        crearColorNotificacion('--color-rojo-oscuro')
    }
    function crearNotificacionAdvertencia(mensaje,titulo) {
        crearNotificacion(mensaje,titulo);
        notificacionIconoAdvertencia();
        crearColorNotificacion('--color-amarillo-oscuro')
    }

  function notificacionIconoOk() {
    iconoNotificacion.className='';
    iconoNotificacion.classList.add('bi','bi-check2-square');
  }
  function notificacionIconoError() {
    iconoNotificacion.className='';
    iconoNotificacion.classList.add('bi','bi-bug');
  }
  function notificacionIconoAdvertencia() {
    iconoNotificacion.className='';
    iconoNotificacion.classList.add('bi','bi-exclamation-square');
  }
  function crearColorNotificacion(color) {
    let elemetoNotificacion = document.getElementById('notificacion');
    elemetoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(color);
  } 

  function crearLoader(elementoPadre) {
    eliminarLoader();
    let loader = document.createElement('div');
    loader.id = 'loader'
    loader.appendChild(document.createElement('div'));
    loader.appendChild(document.createElement('div'));
    loader.appendChild(document.createElement('div'));
    loader.appendChild(document.createElement('div')); 
    return document.getElementById(elementoPadre).appendChild(loader);

  }

  function crearLoaderPuntos(elementoPadre) {
    let loader = crearLoader(elementoPadre);
    loader.classList.add('lds-ellipsis');
  }

  function crearLoaderAnillos(elementoPadre) {
    let loader = crearLoader(elementoPadre);
    loader.classList.add('lds-ring');
  }

  function eliminarLoader() {
    let loader = document.getElementById('loader');
    if(loader) loader.remove();
  }

  function eliminarTabla() {                      
      let tabla = document.getElementById('tablaContactos');
      if (tabla) tabla.remove();
  }
    </script>